Switching from python to 3/3.9.11
  ERROR: Unable to locate a modulefile for '3/3.9.11'
2023-10-11 11:28:24.755419: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
Traceback (most recent call last):
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/tensorflow/python/ops/script_ops.py", line 268, in __call__
    ret = func(*args)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/tensorflow/python/autograph/impl/api.py", line 643, in wrapper
    return func(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/tensorflow/python/data/ops/from_generator_op.py", line 198, in generator_py_func
    values = next(generator_state.get_iterator(iterator_id))
  File "train_score.py", line 206, in chartgenerator
    (ts,xss,chartss,*_) = product((jnp.repeat(x0s[0],x_samples,axis=0),jnp.repeat(x0s[1],x_samples,axis=0)),
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/stochastics/product_sde.py", line 46, in <lambda>
    product = jit(lambda x,dts,dWs,*cy: integrate_sde(sde_product,integrator,chart_update_product,x[0],x[1],dts,dWs,*cy))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/integration/integration.py", line 102, in integrate_sde
    _,xs = scan(integrator(sde,chart_update),
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/integration/integration.py", line 136, in euler
    (detx, stox, X, *dcy) = sde_f(c,y)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/stochastics/product_sde.py", line 40, in sde_product
    (det,sto,X,*dcy) = vmap(lambda x,chart,dW,*_cy: sde((t,x,chart,*_cy),(dt,dW)),0)(x,chart,dW,*cy)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/stochastics/product_sde.py", line 40, in <lambda>
    (det,sto,X,*dcy) = vmap(lambda x,chart,dW,*_cy: sde((t,x,chart,*_cy),(dt,dW)),0)(x,chart,dW,*cy)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/stochastics/Brownian_coords.py", line 38, in sde_Brownian_coords
    gsharpx = M.gsharp((x,chart))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/riemannian/metric.py", line 61, in <lambda>
    M.gsharp = lambda x: jnp.linalg.inv(M.g(x))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/riemannian/manifold.py", line 101, in g
    JF = self.JF(x)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 41, in jacf
    return jacfwd(fxchart,argnums=0)(x[0],x[1],*args,**kwargs)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 39, in fxchart
    return f((x,chart),*args,**kwargs)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 52, in F_steographic
    return self.params*jnp.dot(self.get_B(x[1]), val)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 136, in get_B
    u, _, _ = jnp.linalg.svd(b1)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/numpy/linalg.py", line 88, in svd
    return lax_linalg.svd(a, full_matrices=full_matrices, compute_uv=compute_uv)
jax._src.source_info_util.JaxStackTraceBeforeTransformation: NotImplementedError: Singular value decomposition JVP not implemented for full matrices

The preceding stack trace is the source of the JAX operation that, once transformed by JAX, triggered the following exception.

--------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "train_score.py", line 788, in <module>
    trainxt(manifold=args.manifold,
  File "train_score.py", line 764, in trainxt
    score_matching.trainxt.train_s1(M=M,
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 149, in train_s1
    state, loss_val = update(state, next(train_dataset))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 250, in cache_miss
    outs, out_flat, out_tree, args_flat, jaxpr = _python_pjit_helper(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 158, in _python_pjit_helper
    args_flat, _, params, in_tree, out_tree, _ = infer_params_fn(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 306, in infer_params
    return pjit.common_infer_params(pjit_info_args, *args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 505, in common_infer_params
    jaxpr, consts, canonicalized_out_shardings_flat = _pjit_jaxpr(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 971, in _pjit_jaxpr
    jaxpr, final_consts, out_type = _create_pjit_jaxpr(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 345, in memoized_fun
    ans = call(fun, *args)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 924, in _create_pjit_jaxpr
    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2155, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2177, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 108, in update
    loss, gradients = value_and_grad(loss_fun)(state.params, state.state_val, rng_key, data)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 723, in value_and_grad_f
    ans, vjp_py = _vjp(f_partial, *dyn_args, reduce_axes=reduce_axes)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 2208, in _vjp
    out_primal, out_vjp = ad.vjp(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 139, in vjp
    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 128, in linearize
    jaxpr, out_pvals, consts = pe.trace_to_jaxpr_nounits(jvpfun_flat, in_pvals)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 777, in trace_to_jaxpr_nounits
    jaxpr, (out_pvals, consts, env) = fun.call_wrapped(pvals)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 250, in cache_miss
    outs, out_flat, out_tree, args_flat, jaxpr = _python_pjit_helper(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 158, in _python_pjit_helper
    args_flat, _, params, in_tree, out_tree, _ = infer_params_fn(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 306, in infer_params
    return pjit.common_infer_params(pjit_info_args, *args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 505, in common_infer_params
    jaxpr, consts, canonicalized_out_shardings_flat = _pjit_jaxpr(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 971, in _pjit_jaxpr
    jaxpr, final_consts, out_type = _create_pjit_jaxpr(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 345, in memoized_fun
    ans = call(fun, *args)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 924, in _create_pjit_jaxpr
    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2155, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2177, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in loss_vsm
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 1240, in vmap_f
    out_flat = batching.batch(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in <lambda>
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/riemannian/metric.py", line 97, in <lambda>
    M.div = lambda x,X: jnp.trace(jacfwdx(X)(x))+.5*jnp.dot(X(x),gradx(M.logAbsDet)(x))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 41, in jacf
    return jacfwd(fxchart,argnums=0)(x[0],x[1],*args,**kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 842, in jacfun
    y, jac = vmap(pushfwd, out_axes=(None, -1))(_std_basis(dyn_args))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 1240, in vmap_f
    out_flat = batching.batch(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/api.py", line 1959, in _jvp
    out_primals, out_tangents = ad.jvp(flat_fun).call_wrapped(ps_flat, ts_flat)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 39, in fxchart
    return f((x,chart),*args,**kwargs)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in <lambda>
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "train_score.py", line 454, in <lambda>
    proj_grad = lambda s1, x0, x, t: proj_gradchart(M, s1, x0, x,t)
  File "train_score.py", line 266, in proj_gradchart
    x = update_chartcoords(M, M.F(Fx))
  File "train_score.py", line 255, in update_chartcoords
    return (M.invF((Fx,chart)),chart)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 56, in invF_steographic
    Rinvx = jnp.linalg.solve(self.get_B(x[1]),x[0]/self.params)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 136, in get_B
    u, _, _ = jnp.linalg.svd(b1)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 166, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 250, in cache_miss
    outs, out_flat, out_tree, args_flat, jaxpr = _python_pjit_helper(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 163, in _python_pjit_helper
    out_flat = pjit_p.bind(*args_flat, **params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 2677, in bind
    return self.bind_with_trace(top_trace, args, params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 383, in bind_with_trace
    out = trace.process_primitive(self, map(trace.full_raise, args), params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 315, in process_primitive
    primal_out, tangent_out = jvp(primals_in, tangents_in, **params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/pjit.py", line 1465, in _pjit_jvp
    jaxpr_jvp, is_nz_tangents_out = ad.jvp_jaxpr(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 699, in jvp_jaxpr
    return _jvp_jaxpr(jaxpr, tuple(nonzeros), tuple(instantiate))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 709, in _jvp_jaxpr
    jaxpr_out, avals_out, literals_out = pe.trace_to_jaxpr_dynamic(f_jvp, avals_in)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2155, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/partial_eval.py", line 2177, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/linear_util.py", line 188, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 229, in jaxpr_as_fun
    return eval_jaxpr(closed_jaxpr.jaxpr, closed_jaxpr.consts, *args)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 448, in eval_jaxpr
    ans = eqn.primitive.bind(*subfuns, *map(read, eqn.invars), **bind_params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 380, in bind
    return self.bind_with_trace(find_top_trace(args), args, params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/core.py", line 383, in bind_with_trace
    out = trace.process_primitive(self, map(trace.full_raise, args), params)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/interpreters/ad.py", line 315, in process_primitive
    primal_out, tangent_out = jvp(primals_in, tangents_in, **params)
  File "/appl/python/3.8.2/lib/python3.8/contextlib.py", line 75, in inner
    return func(*args, **kwds)
  File "/zhome/77/8/118225/.local/lib/python3.8/site-packages/jax/_src/lax/linalg.py", line 1711, in _svd_jvp_rule
    raise NotImplementedError(
jax._src.traceback_util.UnfilteredStackTrace: NotImplementedError: Singular value decomposition JVP not implemented for full matrices

The stack trace below excludes JAX-internal frames.
The preceding is the original exception that occurred, unmodified.

--------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "train_score.py", line 788, in <module>
    trainxt(manifold=args.manifold,
  File "train_score.py", line 764, in trainxt
    score_matching.trainxt.train_s1(M=M,
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 149, in train_s1
    state, loss_val = update(state, next(train_dataset))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 108, in update
    loss, gradients = value_and_grad(loss_fun)(state.params, state.state_val, rng_key, data)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in loss_vsm
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in <lambda>
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/riemannian/metric.py", line 97, in <lambda>
    M.div = lambda x,X: jnp.trace(jacfwdx(X)(x))+.5*jnp.dot(X(x),gradx(M.logAbsDet)(x))
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 41, in jacf
    return jacfwd(fxchart,argnums=0)(x[0],x[1],*args,**kwargs)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/autodiff/tuple_autodiff.py", line 39, in fxchart
    return f((x,chart),*args,**kwargs)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/statistics/score_matching/trainxt.py", line 60, in <lambda>
    divs = vmap(lambda x0, xt, chart, t: M.div((xt, chart), lambda x: proj_grad(s1, x0, x, t)))(x0,xts,chartts,t)
  File "train_score.py", line 454, in <lambda>
    proj_grad = lambda s1, x0, x, t: proj_gradchart(M, s1, x0, x,t)
  File "train_score.py", line 266, in proj_gradchart
    x = update_chartcoords(M, M.F(Fx))
  File "train_score.py", line 255, in update_chartcoords
    return (M.invF((Fx,chart)),chart)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 56, in invF_steographic
    Rinvx = jnp.linalg.solve(self.get_B(x[1]),x[0]/self.params)
  File "/zhome/77/8/118225/Desktop/smrdm/smrdm/jaxgeometry/manifolds/Ellipsoid.py", line 136, in get_B
    u, _, _ = jnp.linalg.svd(b1)
  File "/appl/python/3.8.2/lib/python3.8/contextlib.py", line 75, in inner
    return func(*args, **kwds)
NotImplementedError: Singular value decomposition JVP not implemented for full matrices
terminate called without an active exception
/zhome/77/8/118225/.lsbatch/1697016470.18199890.shell: line 33: 16889 Aborted                 python3 train_score.py --manifold Ellipsoid --N 2 --loss_type T --train_net s1 --max_T 0.1 --lr_rate 0.001 --epochs 50000 --x_samples 32 --t_samples 128 --repeats 8 --samples_per_batch 16 --dt_steps 1000 --save_step 10 --seed 2712
